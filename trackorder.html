<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xander | Track Orders</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .order {
      background: #fff;
      padding: 20px;
      margin: 15px auto;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 600px;
    }
    .progress-container {
      position: relative;
      height: 8px;
      background: #ddd;
      border-radius: 5px;
      margin: 30px 0 20px;
      overflow: hidden;
    }
    .progress-bar {
      height: 8px;
      width: 0%;
      background: linear-gradient(90deg, #4cafef, #00c853);
      border-radius: 5px;
      transition: width 0.6s ease;
    }
    .circle-container {
      display: flex;
      justify-content: space-between;
      margin-top: -16px;
      position: relative;
    }
    .circle {
      width: 26px;
      height: 26px;
      background: #ddd;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.4s ease, transform 0.4s ease;
    }
    .circle.active {
      background: #4cafef;
      transform: scale(1.2);
    }
    /* Status text animation */
    .status-text {
      display: inline-block;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .status-text.show {
      opacity: 1;
      transform: translateY(0);
    }
    /* Delivered checkmark */
    .checkmark {
      width: 60px;
      height: 60px;
      stroke-width: 4;
      stroke: #4caf50;
      stroke-miterlimit: 10;
      box-shadow: inset 0px 0px 0px #4caf50;
      border-radius: 50%;
      display: block;
      margin: 20px auto;
      animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
    }
    .checkmark__circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 4;
      stroke-miterlimit: 10;
      stroke: #4caf50;
      fill: none;
      animation: stroke .6s cubic-bezier(.65, 0, .45, 1) forwards;
    }
    .checkmark__check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: stroke .3s cubic-bezier(.65, 0, .45, 1) .8s forwards;
    }
    @keyframes stroke {
      100% { stroke-dashoffset: 0; }
    }
    @keyframes scale {
      0%, 100% { transform: none; }
      50% { transform: scale3d(1.1, 1.1, 1); }
    }
    @keyframes fill {
      100% { box-shadow: inset 0px 0px 0px 30px #4caf50; }
    }
  </style>
</head>
<body>

  <h1>Track Your Orders</h1>
  <div id="orders"></div>

  <script>
    // Load orders from localStorage
    let orders = JSON.parse(localStorage.getItem("orders")) || [];

    // Render orders
    function renderOrders() {
      const container = document.getElementById("orders");
      container.innerHTML = "";

      if (orders.length === 0) {
        container.innerHTML = "<p style='text-align:center'>No orders yet.</p>";
        return;
      }

      orders.forEach((order, index) => {
        container.innerHTML += `
          <div class="order">
            <h3>Order #${index + 1}</h3>
            <p>Item: ${order.item}</p>
            <p>Status: <span id="status-${index}" class="status-text">Processing</span></p>

            <div class="progress-container">
              <div class="progress-bar" id="progress-${index}"></div>
            </div>
            <div class="circle-container">
              <div class="circle" id="circle-${index}-0">1</div>
              <div class="circle" id="circle-${index}-1">2</div>
              <div class="circle" id="circle-${index}-2">3</div>
            </div>
            <div id="delivered-animation-${index}" style="text-align:center; margin-top:20px;"></div>
          </div>
        `;
        updateUI(index, order.step || 0);
      });
    }

    // Update UI with animation
    function updateUI(orderIndex, step) {
      const steps = ["Processing", "Shipped", "Delivered"];
      const progressBar = document.getElementById(`progress-${orderIndex}`);
      const statusLabel = document.getElementById(`status-${orderIndex}`);

      // Animate status text
      statusLabel.classList.remove("show");
      setTimeout(() => {
        statusLabel.textContent = steps[step] || "Processing";
        statusLabel.classList.add("show");
      }, 200);

      // Animate circles
      for (let i = 0; i <= 2; i++) {
        const circle = document.getElementById(`circle-${orderIndex}-${i}`);
        if (i <= step) circle.classList.add("active");
        else circle.classList.remove("active");
      }

      // Animate progress bar
      progressBar.style.width = `${(step / 2) * 100}%`;

      // Delivered animation
      if (step === 2) {
        const animBox = document.getElementById(`delivered-animation-${orderIndex}`);
        animBox.innerHTML = `
          <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark__check" fill="none" d="M14 27l7 7 16-16"/>
          </svg>
        `;
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 }
        });
      }
    }

    // Listen for updates from admin (localStorage sync)
    window.addEventListener("storage", () => {
      orders = JSON.parse(localStorage.getItem("orders")) || [];
      renderOrders();
    });

    // First render
    renderOrders();
  </script>
</body>
</html>
