<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Xander | Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
body{
  background: linear-gradient(270deg,#ff758c,#ff7eb3,#9face6);
  background-size:600% 600%;
  animation: gradientBG 15s ease infinite;
  min-height:100vh; padding:20px;
}
@keyframes gradientBG {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
h1{ text-align:center; color:#fff; margin-bottom:30px; }
.order-card{
  background:rgba(255,255,255,0.95);
  border-radius:15px;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 6px 15px rgba(0,0,0,0.2);
}
.order-header{
  display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:10px;
}
.order-title{ font-size:1.05rem; color:#333; line-height:1.3; }
.controls{ display:flex; gap:8px; flex-wrap:wrap; }
button{
  padding:6px 12px; border:none; border-radius:8px; cursor:pointer;
  background:#4caf50; color:#fff; transition:transform .05s ease, opacity .2s ease, background .2s ease;
}
button:hover{ background:#45a049; }
button:active{ transform:translateY(1px); }
button[disabled]{ opacity:.45; cursor:not-allowed; }

.details{
  font-size:0.9rem; color:#444; margin:10px 0; line-height:1.4;
  background:#f9f9f9; border-radius:10px; padding:10px;
}
.details strong{ color:#222; }

/* Status pill */
.status-line{ font-size:.9rem; color:#444; margin-bottom:10px; }
.status-pill{
  display:inline-block; padding:4px 10px; border-radius:999px; font-size:.8rem; font-weight:600; color:#fff;
}
.status-0{ background:#fb8c00; } /* Processing */
.status-1{ background:#1976d2; } /* Shipped */
.status-2{ background:#2e7d32; } /* Delivered */

/* Progress bar */
.progress-container{ position:relative; height:6px; background:#ddd; border-radius:3px; margin:16px 0; }
.progress{
  height:6px; background:linear-gradient(90deg,#4caf50,#2ecc71); border-radius:3px;
  width:0; transition:width .4s ease-in-out;
}
.step{ position:absolute; top:-20px; transform:translateX(-50%); text-align:center; width:80px; }
.step .circle{
  width:24px; height:24px; border-radius:50%; background:#bbb; color:#fff; display:flex; align-items:center; justify-content:center;
  margin:0 auto 5px; font-size:12px; transition:background .4s ease-in-out, transform .3s;
}
.step.active .circle{ background:#4caf50; transform:scale(1.1); box-shadow:0 0 10px rgba(76,175,80,.8); }
.step .label{ font-size:12px; color:#555; }
</style>
</head>
<body>

<h1>Admin Dashboard</h1>
<div id="adminOrdersContainer"></div>

<script>
const STEP_LABELS = ["Processing","Shipped","Delivered"];
const API_URL = "http://localhost:3000/orders"; // change to your server endpoint

// ---------- Fetch all orders from backend ----------
async function fetchOrders() {
  const res = await fetch(API_URL);
  return await res.json();
}

// ---------- Update order status on backend ----------
async function updateOrder(orderId, newStatus) {
  await fetch(`${API_URL}/${orderId}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ statusStep: newStatus })
  });
}

// ---------- Render Orders ----------
async function loadOrdersForAdmin() {
  const orders = await fetchOrders();
  const container = document.getElementById('adminOrdersContainer');
  container.innerHTML = '';

  if(!orders.length){
    container.innerHTML = "<p style='text-align:center;color:#fff;'>No orders yet.</p>";
    return;
  }

  orders.forEach((order, index) => {
    if(order.statusStep === undefined) order.statusStep = 0;

    const totalCash = (order.price * (order.quantity || 1)).toFixed(2);

    const card = document.createElement('div');
    card.className = 'order-card';
    card.innerHTML = `
      <div class="order-header">
        <div class="order-title"><strong>Order #${index+1}</strong></div>
        <div class="controls">
          <button id="prev-${order.id}">Previous</button>
          <button id="next-${order.id}">Next</button>
        </div>
      </div>

      <div class="details">
        <p><strong>Customer:</strong> ${order.customerName}</p>
        <p><strong>Item:</strong> ${order.name}</p>
        <p><strong>Quantity:</strong> ${order.quantity || 1}</p>
        <p><strong>Price per item:</strong> $${order.price}</p>
        <p><strong>Total Cash:</strong> $${totalCash}</p>
        <p><strong>Order Date:</strong> ${order.orderDate}</p>
      </div>

      <div class="status-line">
        Status: <span id="status-pill-${order.id}" class="status-pill">â€”</span>
      </div>

      <div class="progress-container">
        <div class="progress" id="progress-${order.id}"></div>
        <div class="step" style="left:0%"><div class="circle" id="circle-${order.id}-0">1</div><div class="label">Processing</div></div>
        <div class="step" style="left:50%"><div class="circle" id="circle-${order.id}-1">2</div><div class="label">Shipped</div></div>
        <div class="step" style="left:100%"><div class="circle" id="circle-${order.id}-2">3</div><div class="label">Delivered</div></div>
      </div>
    `;
    container.appendChild(card);

    // Wire buttons
    document.getElementById(`prev-${order.id}`).addEventListener('click', () => changeStep(order.id, -1));
    document.getElementById(`next-${order.id}`).addEventListener('click', () => changeStep(order.id, +1));

    renderProgress(order.id, order.statusStep);
  });
}

// ---------- Render progress for single order ----------
async function renderProgress(orderId, step) {
  const progressBar = document.getElementById(`progress-${orderId}`);
  const pill = document.getElementById(`status-pill-${orderId}`);

  pill.textContent = STEP_LABELS[step] || STEP_LABELS[0];
  pill.className = `status-pill status-${step}`;

  for(let i=0;i<=2;i++){
    const circle = document.getElementById(`circle-${orderId}-${i}`);
    if(i<=step) circle.parentElement.classList.add('active');
    else circle.parentElement.classList.remove('active');
  }

  progressBar.style.width = (step/2 * 100) + '%';

  document.getElementById(`prev-${orderId}`).disabled = step <= 0;
  document.getElementById(`next-${orderId}`).disabled = step >= 2;
}

// ---------- Change step ----------
async function changeStep(orderId, delta){
  const orders = await fetchOrders();
  const order = orders.find(o => o.id === orderId);
  if(!order) return;

  const nextStep = Math.max(0, Math.min(2, order.statusStep + delta));
  if(nextStep === order.statusStep){
    renderProgress(orderId, nextStep);
    return;
  }

  await updateOrder(orderId, nextStep);
  renderProgress(orderId, nextStep);
}

// ---------- Polling for real-time sync ----------
setInterval(loadOrdersForAdmin, 5000); // refresh every 5 seconds
loadOrdersForAdmin();
</script>

</body>
</html>
