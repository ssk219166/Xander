<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Xander | Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
body{
  background: linear-gradient(270deg,#ff758c,#ff7eb3,#9face6);
  background-size:600% 600%;
  animation: gradientBG 15s ease infinite;
  min-height:100vh; padding:20px;
}
@keyframes gradientBG {
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
h1{ text-align:center; color:#fff; margin-bottom:30px; }
.order-card{
  background:rgba(255,255,255,0.95);
  border-radius:15px;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 6px 15px rgba(0,0,0,0.2);
}
.order-header{
  display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:10px;
}
.order-title{ font-size:1.05rem; color:#333; line-height:1.3; }
.controls{ display:flex; gap:8px; flex-wrap:wrap; }
button{
  padding:6px 12px; border:none; border-radius:8px; cursor:pointer;
  background:#4caf50; color:#fff; transition:transform .05s ease, opacity .2s ease, background .2s ease;
}
button:hover{ background:#45a049; }
button:active{ transform:translateY(1px); }
button[disabled]{ opacity:.45; cursor:not-allowed; }

.details{
  font-size:0.9rem; color:#444; margin:10px 0; line-height:1.4;
  background:#f9f9f9; border-radius:10px; padding:10px;
}
.details strong{ color:#222; }

/* Status pill */
.status-line{ font-size:.9rem; color:#444; margin-bottom:10px; }
.status-pill{
  display:inline-block; padding:4px 10px; border-radius:999px; font-size:.8rem; font-weight:600; color:#fff;
}
.status-0{ background:#fb8c00; } /* Processing */
.status-1{ background:#1976d2; } /* Shipped */
.status-2{ background:#2e7d32; } /* Delivered */

/* Progress bar */
.progress-container{ position:relative; height:6px; background:#ddd; border-radius:3px; margin:16px 0; }
.progress{
  height:6px; background:linear-gradient(90deg,#4caf50,#2ecc71); border-radius:3px;
  width:0; transition:width .4s ease-in-out;
}
.step{ position:absolute; top:-20px; transform:translateX(-50%); text-align:center; width:80px; }
.step .circle{
  width:24px; height:24px; border-radius:50%; background:#bbb; color:#fff; display:flex; align-items:center; justify-content:center;
  margin:0 auto 5px; font-size:12px; transition:background .4s ease-in-out, transform .3s;
}
.step.active .circle{ background:#4caf50; transform:scale(1.1); box-shadow:0 0 10px rgba(76,175,80,.8); }
.step .label{ font-size:12px; color:#555; }

/* âœ… Checkmark Animation */
.checkmark {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: block;
  stroke-width: 3;
  stroke: #4caf50;
  stroke-miterlimit: 10;
  margin: 10px auto;
  box-shadow: inset 0px 0px 0px #4caf50;
  animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
}
.checkmark__circle {
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 3;
  stroke-miterlimit: 10;
  stroke: #4caf50;
  fill: none;
  animation: stroke 0.6s cubic-bezier(.65,.05,.36,1) forwards;
}
.checkmark__check {
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: stroke 0.3s cubic-bezier(.65,.05,.36,1) 0.7s forwards;
}
@keyframes stroke { 100% { stroke-dashoffset: 0; } }
@keyframes scale { 0%,100%{transform:none;} 50%{transform:scale3d(1.1,1.1,1);} }
@keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #4caf50; } }
</style>
</head>
<body>

<h1>Admin Dashboard</h1>
<div id="adminOrdersContainer"></div>

<!-- ðŸŽŠ Confetti JS -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<script>
const STEP_LABELS = ["Processing","Shipped","Delivered"];
function getOrders(){ return JSON.parse(localStorage.getItem('pastOrders') || '[]'); }
function setOrders(orders){ localStorage.setItem('pastOrders', JSON.stringify(orders)); }
function getUserProfile(){ return JSON.parse(localStorage.getItem('userProfile') || '{}'); }

function loadOrdersForAdmin(){
  const orders = getOrders();
  const container = document.getElementById('adminOrdersContainer');
  container.innerHTML = '';
  if(!orders.length){
    container.innerHTML = "<p style='text-align:center;color:#fff;'>No orders yet.</p>";
    return;
  }
  const profile = getUserProfile();

  orders.forEach((order,index)=>{
    if(order.statusStep===undefined) order.statusStep=0;
    if(!order.orderDate) order.orderDate = new Date().toLocaleString();
    if(!order.customerName && profile.name) order.customerName = profile.name;
    const totalCash = (order.price*(order.quantity||1)).toFixed(2);

    const card = document.createElement('div');
    card.className='order-card';
    card.innerHTML=`
      <div class="order-header">
        <div class="order-title"><strong>Order #${index+1}</strong></div>
        <div class="controls">
          <button id="prev-${index}">Previous</button>
          <button id="next-${index}">Next</button>
        </div>
      </div>
      <div class="details">
        <p><strong>Customer:</strong> ${order.customerName || "Unknown"}</p>
        <p><strong>Item:</strong> ${order.name}</p>
        <p><strong>Quantity:</strong> ${order.quantity||1}</p>
        <p><strong>Price per item:</strong> $${order.price}</p>
        <p><strong>Total Cash:</strong> $${totalCash}</p>
        <p><strong>Order Date:</strong> ${order.orderDate}</p>
      </div>
      <div class="status-line">
        Status: <span id="status-pill-${index}" class="status-pill">â€”</span>
      </div>
      <div class="progress-container">
        <div class="progress" id="progress-${index}"></div>
        <div class="step" style="left:0%"><div class="circle" id="circle-${index}-0">1</div><div class="label">Processing</div></div>
        <div class="step" style="left:50%"><div class="circle" id="circle-${index}-1">2</div><div class="label">Shipped</div></div>
        <div class="step" style="left:100%"><div class="circle" id="circle-${index}-2">3</div><div class="label">Delivered</div></div>
      </div>
      <div id="delivered-animation-${index}" style="text-align:center; display:none;"></div>
    `;
    container.appendChild(card);

    document.getElementById(`prev-${index}`).addEventListener('click',()=>changeStep(index,-1));
    document.getElementById(`next-${index}`).addEventListener('click',()=>changeStep(index,+1));

    renderProgress(index, order.statusStep);
  });
}

function renderProgress(orderIndex, step){
  const progressBar=document.getElementById(`progress-${orderIndex}`);
  const pill=document.getElementById(`status-pill-${orderIndex}`);

  pill.textContent = STEP_LABELS[step]||STEP_LABELS[0];
  pill.className=`status-pill status-${step}`;

  for(let i=0;i<=2;i++){
    const circle=document.getElementById(`circle-${orderIndex}-${i}`);
    if(i<=step) circle.parentElement.classList.add('active');
    else circle.parentElement.classList.remove('active');
  }

  progressBar.style.width = (step/2*100)+'%';

  const prevBtn=document.getElementById(`prev-${orderIndex}`);
  const nextBtn=document.getElementById(`next-${orderIndex}`);
  if(prevBtn) prevBtn.disabled = step<=0;
  if(nextBtn) nextBtn.disabled = step>=2;

  // âœ… Checkmark + Confetti when Delivered
  const animBox=document.getElementById(`delivered-animation-${orderIndex}`);
  if(step===2){
    animBox.style.display="block";
    animBox.innerHTML = `
      <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="checkmark__check" fill="none" d="M14 27l7 7 16-16"/>
      </svg>
    `;
    confetti({particleCount:100,spread:70,origin:{y:0.6}});
  } else {
    animBox.style.display="none";
    animBox.innerHTML='';
  }
}

function changeStep(orderIndex,delta){
  const orders=getOrders();
  const order=orders[orderIndex];
  if(!order) return;
  const nextStep=Math.max(0,Math.min(2,(order.statusStep??0)+delta));
  if(nextStep===order.statusStep){ renderProgress(orderIndex,nextStep); return; }
  order.statusStep=nextStep;
  orders[orderIndex]=order;
  setOrders(orders);
  renderProgress(orderIndex,nextStep);
}

window.addEventListener('storage',(e)=>{ if(e.key==='pastOrders') loadOrdersForAdmin(); });

loadOrdersForAdmin();
</script>
</body>
</html>
